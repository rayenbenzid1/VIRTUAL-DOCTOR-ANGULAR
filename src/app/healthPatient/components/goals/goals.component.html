<div class="goals-container">
  <!-- Header -->
  <div class="page-header">
    <button class="btn-back" (click)="goBack()">
      ‚Üê
    </button>
    <div class="header-title">
      <h1>üéØ Objectifs Sant√©</h1>
      <p class="header-subtitle">D√©finissez et atteignez vos objectifs personnalis√©s</p>
    </div>
  </div>

  <div class="goals-content">
    <!-- Configuration (affich√©e si pas d'objectifs ou si demand√©e) -->
    @if (showConfig()) {
      <div class="goals-config-section">
        <app-goal-config (configChanged)="onConfigChanged($event)"></app-goal-config>
      </div>
    }

    <!-- Loading State -->
    @if (loading()) {
      <div class="loading-section">
        <div class="loading-spinner"></div>
        <p>G√©n√©ration de vos objectifs personnalis√©s...</p>
      </div>
    }

    <!-- Error State -->
    @if (error()) {
      <div class="error-section">
        <span class="error-icon">‚ö†Ô∏è</span>
        <h3>Erreur</h3>
        <p>{{ error() }}</p>
        <button class="btn-retry" (click)="regenerateGoals()">R√©essayer</button>
      </div>
    }

    <!-- Goals Summary -->
    @if (hasGoals() && !showConfig()) {
      <div class="goals-summary">
        <div class="summary-card">
          <div class="summary-header">
            <h2>üéØ Votre Plan Personnalis√©</h2>
            <p>Suivez votre progression vers vos objectifs sant√©</p>
          </div>
          
          <div class="score-section">
            <div class="score-box current">
              <span class="score-label">Score actuel</span>
              <span class="score-value">{{ goalsData()?.average_current_health_score?.split(' ')?.[0] }}</span>
            </div>
            <span class="score-arrow">‚Üí</span>
            <div class="score-box projected">
              <span class="score-label">Score projet√©</span>
              <span class="score-value">{{ goalsData()?.projected_health_score?.split(' ')?.[0] }}</span>
            </div>
          </div>

          <div class="summary-stats">
            <div class="stat-item">
              <span class="stat-value">{{ totalGoals() }}</span>
              <span class="stat-label">Objectifs</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{ goalsData()?.timeframe_days }}</span>
              <span class="stat-label">Jours</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">+{{ goalsData()?.estimated_improvement }}</span>
              <span class="stat-label">Points</span>
            </div>
          </div>

          <button class="regenerate-button" (click)="regenerateGoals()">
            <span class="button-icon">üîÑ</span>
            <span>G√©n√©rer de nouveaux objectifs</span>
          </button>
        </div>
      </div>

      <!-- Section Title -->
      <h3 class="section-title">
        <span class="section-icon">üìã</span>
        Vos Objectifs
      </h3>

      <!-- Goals List -->
      <div class="goals-list">
        @for (goal of goalsData()?.goals; track goal.category) {
          <app-goal-card [goal]="goal"></app-goal-card>
        }
      </div>
    }
  </div>
</div>