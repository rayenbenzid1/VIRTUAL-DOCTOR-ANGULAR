<div class="alerts-container">

  <!-- Header avec bouton retour -->
  <div class="page-header">
    <button class="btn-back" (click)="goBack()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
    </button>
    <div class="header-title">
      <h1>ğŸš¨ Alertes MÃ©dicales</h1>
      <p class="header-subtitle">Surveillance de votre santÃ©</p>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-section">
    <div class="loading-spinner"></div>
    <p>Analyse de vos donnÃ©es de santÃ©...</p>
  </div>
  }

  <!-- Error State -->
  @if (error() && !isLoading()) {
  <div class="error-section">
    <div class="error-icon">âš ï¸</div>
    <h3>Erreur de chargement</h3>
    <p>{{ error() }}</p>
    <button class="btn-retry" (click)="loadAlerts()">RÃ©essayer</button>
  </div>
  }

  <!-- Main Content -->
  @if (!isLoading() && !error() && alertsData()) {
  <div class="alerts-content">

    <!-- PÃ©riode d'analyse -->
    <app-analysis-period
      [selectedPeriod]="selectedPeriod()"
      [selectedDate]="selectedDate()"
      (periodChange)="onPeriodChange($event)"
      (dateSelected)="onDateSelected($event)"
      (analyze)="onAnalyze()">
    </app-analysis-period>

    <!-- Header des alertes -->
    <app-alerts-header
      [alertLevel]="alertLevel()"
      [alertLevelColor]="alertLevelColor()"
      [analysisPeriod]="alertsData()!.analysis_period"
      [analysisType]="alertsData()!.analysis_type"
      [dataPointsAnalyzed]="alertsData()!.data_points_analyzed">
    </app-alerts-header>

    <!-- Moyennes de la pÃ©riode -->
    <div class="averages-section">
      <h2 class="section-title">
        <span class="section-icon">ğŸ“Š</span>
        Moyennes de la pÃ©riode
      </h2>
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-icon">ğŸš¶</div>
          <div class="metric-label">Pas</div>
          <div class="metric-value">{{ alertsData()!.averages_computed.steps | number }} pas/jour</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">ğŸ’¤</div>
          <div class="metric-label">Sommeil</div>
          <div class="metric-value">{{ alertsData()!.averages_computed.sleep_hours }}h/nuit</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">â¤ï¸</div>
          <div class="metric-label">FC moyenne</div>
          <div class="metric-value">{{ alertsData()!.averages_computed.heart_rate }} bpm</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">ğŸ§ </div>
          <div class="metric-label">Stress</div>
          <div class="metric-value">{{ alertsData()!.averages_computed.stress_score }}/100</div>
        </div>
        <div class="metric-card">
          <div class="metric-icon">ğŸ’§</div>
          <div class="metric-label">Hydratation</div>
          <div class="metric-value">{{ alertsData()!.averages_computed.hydration_liters }}L/jour</div>
        </div>
      </div>
    </div>

    <!-- Alertes actives -->
    @if (criticalAlerts().length > 0 || warningAlerts().length > 0) {
    <div class="active-alerts-section">
      <h2 class="section-title">
        <span class="section-icon">ğŸ””</span>
        Alertes Actives
      </h2>

      @for (alert of criticalAlerts(); track $index) {
      <div class="alert-item critical">
        <div class="alert-icon">ğŸš¨</div>
        <div class="alert-text">{{ alert }}</div>
      </div>
      }

      @for (alert of warningAlerts(); track $index) {
      <div class="alert-item warning">
        <div class="alert-icon">âš ï¸</div>
        <div class="alert-text">{{ alert }}</div>
      </div>
      }
    </div>
    }

    <!-- Facteurs de risque -->
    @if (alertsData()!.risk_factors.length > 0) {
    <app-risk-factors [riskFactors]="alertsData()!.risk_factors"></app-risk-factors>
    }

    <!-- Actions prioritaires -->
    @if (alertsData()!.action_priorities.length > 0) {
    <app-action-priorities [actionPriorities]="alertsData()!.action_priorities"></app-action-priorities>
    }

    <!-- Prochain contrÃ´le recommandÃ© -->
    <div class="next-checkup-section">
      <div class="checkup-card">
        <div class="checkup-icon">ğŸ“…</div>
        <div class="checkup-content">
          <h3>Prochain contrÃ´le recommandÃ©</h3>
          <p class="checkup-date">{{ alertsData()!.next_checkup_recommended | date:'dd/MM/yyyy' }}</p>
        </div>
      </div>
    </div>

  </div>
  }

</div>