<div class="register-container">
  
  <div class="header-section">
    <h2>CrÃ©er un compte</h2>
    <p class="subtitle">Rejoignez-nous aujourd'hui</p>
  </div>

  <!-- Alerte d'erreur globale -->
  <div *ngIf="globalError()" class="error-alert">
    <span class="error-alert-icon">âŒ</span>
    <span class="error-alert-text">{{ globalError() }}</span>
  </div>

  <!-- Type de compte -->
  <div class="account-type">
    <label class="account-type-label">Type de compte</label>
    <div class="radio-group">
      <div class="radio-option">
        <input 
          type="radio" 
          id="patient" 
          name="role" 
          [checked]="role() === 'USER'"
          (change)="changeRole('USER')" />
        <label for="patient" class="radio-button">
          <span class="radio-icon"></span>
          <span>Patient</span>
        </label>
      </div>
      
      <div class="radio-option">
        <input 
          type="radio" 
          id="doctor" 
          name="role" 
          [checked]="role() === 'DOCTOR'"
          (change)="changeRole('DOCTOR')" />
        <label for="doctor" class="radio-button">
          <span class="radio-icon"></span>
          <span>MÃ©decin</span>
        </label>
      </div>
    </div>
  </div>

  <form [formGroup]="form" (ngSubmit)="submit()">

    <!-- PrÃ©nom -->
    <div class="field">
      <label>PrÃ©nom</label>
      <div class="input-wrapper">
        <span class="input-icon">ğŸ‘¤</span>
        <input
          formControlName="firstName"
          placeholder="PrÃ©nom"
          type="text"
          autocomplete="given-name"
          [class.error]="isFieldInvalid('firstName')" />
      </div>
      <div *ngIf="isFieldInvalid('firstName')" class="error-message">
        Le prÃ©nom est requis
      </div>
    </div>

    <!-- Nom -->
    <div class="field">
      <label>Nom</label>
      <div class="input-wrapper">
        <span class="input-icon">ğŸ‘¤</span>
        <input
          formControlName="lastName"
          placeholder="Nom"
          type="text"
          autocomplete="family-name"
          [class.error]="isFieldInvalid('lastName')" />
      </div>
      <div *ngIf="isFieldInvalid('lastName')" class="error-message">
        Le nom est requis
      </div>
    </div>

    <!-- Email systÃ¨me (pour mÃ©decin uniquement) -->
    <div class="field" *ngIf="role() === 'DOCTOR'">
      <label>Email systÃ¨me</label>
      <div class="input-wrapper">
        <span class="input-icon">ğŸ“§</span>
        <input
          formControlName="systemEmail"
          placeholder="Email systÃ¨me (@doctor.com)"
          type="email"
          autocomplete="email"
          [class.error]="isFieldInvalid('systemEmail')" />
      </div>
      <div *ngIf="isFieldInvalid('systemEmail')" class="error-message">
        Email systÃ¨me valide requis (doit finir par @doctor.com)
      </div>
    </div>

    <!-- Email de contact -->
    <div class="field">
      <label>Email</label>
      <div class="input-wrapper">
        <span class="input-icon">ğŸ“§</span>
        <input
          formControlName="email"
          [placeholder]="role() === 'DOCTOR' ? 'Email de contact (pour recevoir les...' : 'Email'"
          type="email"
          autocomplete="email"
          [class.error]="isFieldInvalid('email')" />
      </div>
      <div *ngIf="isFieldInvalid('email')" class="error-message">
        Email valide requis
      </div>
    </div>

    <!-- TÃ©lÃ©phone -->
    <div class="field">
      <label>TÃ©lÃ©phone</label>
      <div class="input-wrapper">
        <span class="input-icon">ğŸ“±</span>
        <input
          formControlName="phone"
          placeholder="TÃ©lÃ©phone"
          type="tel"
          autocomplete="tel"
          [class.error]="isFieldInvalid('phone')" />
      </div>
      <div *ngIf="isFieldInvalid('phone')" class="error-message">
        Le tÃ©lÃ©phone est requis
      </div>
    </div>

    <!-- Champs spÃ©cifiques au mÃ©decin -->
    <ng-container *ngIf="role() === 'DOCTOR'">
      
      <!-- SpÃ©cialisation -->
      <div class="field">
        <label>SpÃ©cialisation</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ©º</span>
          <input
            formControlName="specialization"
            placeholder="SpÃ©cialisation"
            type="text"
            [class.error]="isFieldInvalid('specialization')" />
        </div>
        <div *ngIf="isFieldInvalid('specialization')" class="error-message">
          La spÃ©cialisation est requise
        </div>
      </div>

      <!-- NumÃ©ro de licence -->
      <div class="field">
        <label>NumÃ©ro de licence</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ†”</span>
          <input
            formControlName="licenseNumber"
            placeholder="NumÃ©ro de licence"
            type="text"
            [class.error]="isFieldInvalid('licenseNumber')" />
        </div>
        <div *ngIf="isFieldInvalid('licenseNumber')" class="error-message">
          Le numÃ©ro de licence est requis
        </div>
      </div>

      <!-- AnnÃ©es d'expÃ©rience -->
      <div class="field">
        <label>AnnÃ©es d'expÃ©rience</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ“…</span>
          <input
            formControlName="yearsOfExperience"
            placeholder="AnnÃ©es d'expÃ©rience"
            type="number"
            min="0"
            [class.error]="isFieldInvalid('yearsOfExperience')" />
        </div>
        <div *ngIf="isFieldInvalid('yearsOfExperience')" class="error-message">
          Les annÃ©es d'expÃ©rience sont requises
        </div>
      </div>

      <!-- Formation -->
      <div class="field">
        <label>Formation</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ“</span>
          <input
            formControlName="education"
            placeholder="Formation (ex: MD, PhD)"
            type="text"
            [class.error]="isFieldInvalid('education')" />
        </div>
        <div *ngIf="isFieldInvalid('education')" class="error-message">
          La formation est requise
        </div>
      </div>

      <!-- Nom de la clinique/hÃ´pital -->
      <div class="field">
        <label>Nom de la clinique/hÃ´pital</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ¥</span>
          <input
            formControlName="hospitalName"
            placeholder="Nom de la clinique/hÃ´pital"
            type="text"
            [class.error]="isFieldInvalid('hospitalName')" />
        </div>
        <div *ngIf="isFieldInvalid('hospitalName')" class="error-message">
          Le nom de la clinique/hÃ´pital est requis
        </div>
      </div>

      <!-- Adresse de la clinique -->
      <div class="field">
        <label>Adresse de la clinique</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ“</span>
          <input
            formControlName="hospitalAddress"
            placeholder="Adresse de la clinique"
            type="text"
            [class.error]="isFieldInvalid('hospitalAddress')" />
        </div>
        <div *ngIf="isFieldInvalid('hospitalAddress')" class="error-message">
          L'adresse est requise
        </div>
      </div>

      <!-- Frais de consultation -->
      <div class="field">
        <label>Frais de consultation</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸ’°</span>
          <input
            formControlName="consultationFee"
            placeholder="Frais de consultation (optionnel)"
            type="number"
            min="0" />
        </div>
      </div>

      <!-- Langues parlÃ©es -->
      <div class="field">
        <label>Langues parlÃ©es</label>
        <div class="input-wrapper">
          <span class="input-icon">ğŸŒ</span>
          <input
            formControlName="languages"
            placeholder="Langues parlÃ©es (sÃ©parÃ©es par virgule)"
            type="text"
            [class.error]="isFieldInvalid('languages')" />
        </div>
        <div *ngIf="isFieldInvalid('languages')" class="error-message">
          Les langues parlÃ©es sont requises
        </div>
      </div>

      <!-- Biographie professionnelle -->
      <div class="field">
        <label>Biographie professionnelle</label>
        <div class="input-wrapper">
          <span class="input-icon" style="top: 20px; transform: none;">ğŸ“</span>
          <textarea
            formControlName="bio"
            placeholder="Biographie professionnelle"
            rows="4"
            [class.error]="isFieldInvalid('bio')"></textarea>
        </div>
        <div *ngIf="isFieldInvalid('bio')" class="error-message">
          La biographie est requise
        </div>
      </div>

      <!-- DisponibilitÃ© -->
      <div class="availability-section">
        <label class="availability-label">DisponibilitÃ©</label>
        <div class="checkbox-group">
          <label class="checkbox-option">
            <input 
              type="checkbox" 
              [checked]="onlineConsultation()"
              (change)="onlineConsultation.set(!onlineConsultation())" />
            <span class="checkbox-text">Consultations en ligne</span>
          </label>
          
          <label class="checkbox-option">
            <input 
              type="checkbox" 
              [checked]="inPersonConsultation()"
              (change)="inPersonConsultation.set(!inPersonConsultation())" />
            <span class="checkbox-text">Consultations en personne</span>
          </label>
        </div>
      </div>
    </ng-container>

    <!-- Mot de passe -->
    <div class="field">
      <label>Mot de passe</label>
      <div class="input-wrapper password-wrapper">
        <span class="input-icon">ğŸ”’</span>
        <input
          [type]="hidePassword() ? 'password' : 'text'"
          formControlName="password"
          placeholder="Mot de passe"
          autocomplete="new-password"
          [class.error]="isFieldInvalid('password')" />
        <span class="eye-icon" (click)="togglePassword()">
          {{ hidePassword() ? 'ğŸ‘' : 'ğŸ‘â€ğŸ—¨' }}
        </span>
      </div>
      <div *ngIf="isFieldInvalid('password')" class="error-message">
        Mot de passe requis (min. 6 caractÃ¨res)
      </div>
    </div>

    <!-- Confirmer le mot de passe -->
    <div class="field">
      <label>Confirmer mot de passe</label>
      <div class="input-wrapper password-wrapper">
        <span class="input-icon">ğŸ”’</span>
        <input
          [type]="hideConfirmPassword() ? 'password' : 'text'"
          formControlName="confirmPassword"
          placeholder="Confirmer mot de passe"
          autocomplete="new-password"
          [class.error]="isFieldInvalid('confirmPassword') || passwordMismatch()" />
        <span class="eye-icon" (click)="toggleConfirmPassword()">
          {{ hideConfirmPassword() ? 'ğŸ‘' : 'ğŸ‘â€ğŸ—¨' }}
        </span>
      </div>
      <div *ngIf="form.get('confirmPassword')?.touched && passwordMismatch()" class="error-message">
        Les mots de passe ne correspondent pas
      </div>
    </div>

    <!-- Conditions d'utilisation -->
    <div class="terms-wrapper">
      <label class="terms-option">
        <input 
          type="checkbox" 
          formControlName="acceptTerms" />
        <span class="terms-text">
          J'accepte les conditions d'utilisation
        </span>
      </label>
      <div *ngIf="isFieldInvalid('acceptTerms')" class="error-message" style="margin-left: 30px;">
        Vous devez accepter les conditions
      </div>
    </div>

    <!-- Bouton d'inscription -->
    <button type="submit" class="submit" [disabled]="loading()">
      {{ loading() ? 'Inscription en cours...' : "S'inscrire" }}
    </button>

    <!-- Lien de connexion -->
    <div class="login-link">
      Vous avez dÃ©jÃ  un compte ?
      <a routerLink="/login">Se connecter</a>
    </div>

  </form>
</div>

<!-- Toast -->
<div *ngIf="toastMessage()" [class]="'toast ' + toastType()">
  {{ toastMessage() }}
</div>