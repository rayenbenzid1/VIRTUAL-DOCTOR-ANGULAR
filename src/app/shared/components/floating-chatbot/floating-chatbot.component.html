<!-- Bouton flottant -->
<button 
  *ngIf="isVisible() && !isOpen()"
  class="floating-button"
  (click)="openModal()"
  title="Ouvrir l'assistant IA">
  <span class="bot-emoji">ðŸ¤–</span>
  <span class="pulse-ring"></span>
</button>

<!-- Modal ChatBot -->
<div class="chatbot-modal" [class.open]="isOpen()" *ngIf="isVisible()">
  
  <!-- Overlay -->
  <div class="modal-overlay" (click)="closeModal()" *ngIf="isOpen()"></div>
  
  <!-- Modal Content -->
  <div class="modal-content" *ngIf="isOpen()">
    
    <!-- Header -->
    <div class="chatbot-header">
      <div class="header-left">
        <div class="bot-avatar">
          <span class="bot-icon">ðŸ¤–</span>
          <span class="status-indicator"></span>
        </div>
        <div class="header-text">
          <h1>Assistant SantÃ© IA</h1>
          <p class="status-text">En ligne</p>
        </div>
      </div>

      <div class="header-actions">

        <button class="btn-close" (click)="closeModal()" title="Fermer">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
    </div>

    <!-- Messages Container -->
    <div class="messages-container" #messagesContainer>
      <div *ngFor="let message of messages()" 
           [class]="message.isUser ? 'message-wrapper user' : 'message-wrapper bot'">
        
        <div class="message-avatar" *ngIf="!message.isUser">
          <span>ðŸ¤–</span>
        </div>

        <div [class]="message.isUser ? 'message-bubble user-bubble' : 'message-bubble bot-bubble'">
          <p class="message-text">{{ message.text }}</p>
          <span class="message-time" *ngIf="message.timestamp">
            {{ message.timestamp | date:'HH:mm' }}
          </span>
        </div>

        <div class="message-avatar" *ngIf="message.isUser">
          <span>ðŸ‘¤</span>
        </div>
      </div>

      <!-- Loading Indicator -->
      <div class="message-wrapper bot" *ngIf="loading()">
        <div class="message-avatar">
          <span>ðŸ¤–</span>
        </div>
        <div class="message-bubble bot-bubble typing">
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-container">
      <div class="input-wrapper">
        <textarea
          [(ngModel)]="userMessage"
          (keypress)="onKeyPress($event)"
          placeholder="Posez votre question..."
          rows="1"
          [disabled]="loading()"
          class="message-input"></textarea>
        
        <button 
          class="btn-send" 
          (click)="sendMessage()"
          [disabled]="!userMessage().trim() || loading()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
        </button>
      </div>
    </div>

  </div>
</div>